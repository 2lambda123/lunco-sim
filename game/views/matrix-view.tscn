[gd_scene load_steps=47 format=2]

[ext_resource path="res://controls/spacecraft/spacecraft-controller.tscn" type="PackedScene" id=1]
[ext_resource path="res://addons/lunco-cameras/gimbal-camera/gimbal-camera.tscn" type="PackedScene" id=2]
[ext_resource path="res://maps/demo-map.tscn" type="PackedScene" id=3]
[ext_resource path="res://views/code/Avatar.gd" type="Script" id=4]
[ext_resource path="res://views/code/world.gd" type="Script" id=5]
[ext_resource path="res://ui/spacecraft-ui.tscn" type="PackedScene" id=6]
[ext_resource path="res://player/player.tscn" type="PackedScene" id=7]
[ext_resource path="res://controls/operator/operator.tscn" type="PackedScene" id=8]
[ext_resource path="res://addons/lunco-content/spacex-starship/source/SpaceX_Starship.tscn" type="PackedScene" id=9]
[ext_resource path="res://addons/imjp94.yafsm/src/StateMachinePlayer.gd" type="Script" id=10]
[ext_resource path="res://addons/imjp94.yafsm/src/states/State.gd" type="Script" id=11]
[ext_resource path="res://addons/imjp94.yafsm/src/states/StateMachine.gd" type="Script" id=12]
[ext_resource path="res://addons/imjp94.yafsm/src/transitions/Transition.gd" type="Script" id=13]
[ext_resource path="res://addons/imjp94.yafsm/src/conditions/Condition.gd" type="Script" id=14]
[ext_resource path="res://addons/lunco-cameras/spring-arm-camera/spring-arm-camera.tscn" type="PackedScene" id=15]

[sub_resource type="Resource" id=11]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 350, 294.5 )
}
name = "Entry"

[sub_resource type="Resource" id=12]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 670, 434.5 )
}
name = "Idle"

[sub_resource type="Resource" id=18]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( -30, -5.5 )
}
name = "Param thrust"

[sub_resource type="Resource" id=19]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( -30, -5.5 )
}
name = "Param thrust2"

[sub_resource type="Resource" id=40]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( -30, -5.5 )
}
name = "Param thrust3"

[sub_resource type="Resource" id=41]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( -30, -5.5 )
}
name = "Param thrust4"

[sub_resource type="Resource" id=13]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 647, 74.5 )
}
name = "Param: thrust"

[sub_resource type="Resource" id=45]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( -30, -5.5 )
}
name = "Param thrust5"

[sub_resource type="Resource" id=14]
script = ExtResource( 13 )
from = "Entry"
to = "Idle"
conditions = {
}

[sub_resource type="Resource" id=20]
script = ExtResource( 12 )
name = ""
states = {
"Entry": SubResource( 11 ),
"Idle": SubResource( 12 ),
"Param thrust": SubResource( 18 ),
"Param thrust2": SubResource( 19 ),
"Param thrust3": SubResource( 40 ),
"Param thrust4": SubResource( 41 ),
"Param thrust5": SubResource( 45 ),
"Param: thrust": SubResource( 13 )
}
transitions = {
"Entry": {
"Idle": SubResource( 14 )
}
}

[sub_resource type="ConvexPolygonShape" id=42]
points = PoolVector3Array( 0.0221092, 0.00757432, 0.489795, 0.0100371, -0.0446932, 0.0210085, 0.00871438, -0.0446004, 0.00038279, 0.0483506, 0.0279611, 0.000500619, 0.00956953, 0.0452483, 0.0117146, 0.0483506, -0.0285361, 0.0304007, 0.00938244, -0.0367591, 0.437352, 0.0417018, 0.0246305, 0.399237, 0.00970736, 0.0417913, 0.406254, 0.0402614, -0.0165826, 0.405053, 0.00846953, -0.00526921, 0.525614, 0.0195058, -0.0403584, 0.375638, 0.00846953, 0.0479069, 0.193299, 0.0184408, -0.0451513, -0.00286186, 0.0117959, 0.0479069, -0.00286186, 0.043323, -0.00475908, 0.403043, 0.00846953, 0.02464, 0.492352, 0.0450243, -0.0285361, -0.00286186, 0.0254432, 0.036787, 0.387411, 0.0450243, 0.0312728, 0.0570418, 0.0313869, -0.0286234, 0.411999, 0.00967823, -0.0424319, 0.40026, 0.0483506, 0.0213094, 0.066974, 0.00846953, -0.025215, 0.492352, 0.0314957, -0.00800336, 0.460817, 0.0342456, -0.0280363, 0.394237, 0.0483506, -0.00193863, 0.0902526, 0.0192208, 0.0349436, 0.428314, 0.0284084, -0.0341396, 0.39232, 0.0375856, 0.00735428, 0.437253, 0.0194013, 0.0402539, 0.386002, 0.0253086, -0.0173379, 0.467503, 0.043348, 0.00419159, 0.403281, 0.0483506, -0.0285361, 0.00717381, 0.0192142, -0.0355438, 0.42538, 0.0483506, 0.0279611, 0.0470578, 0.00846953, 0.00469423, 0.525614, 0.0426889, -0.0131319, 0.385594, 0.0370964, -0.0249006, 0.390194, 0.0253106, 0.0136552, 0.473636, 0.0250857, 0.0412552, -0.00286186, 0.0250857, -0.0418301, -0.00286186, 0.0483506, -0.0252055, 0.0603008, 0.0161938, -0.0415212, 0.391173, 0.0314433, -0.0230854, 0.433068, 0.02211, -0.00186144, 0.492904, 0.0222548, 0.0289477, 0.444468, 0.0375569, -0.00790535, 0.436702, 0.0253531, -0.029318, 0.434006, 0.0315048, 0.00745102, 0.461403, 0.0400282, -0.019165, 0.393545, 0.0222178, 0.0198325, 0.470291, 0.0221713, -0.014324, 0.481279, 0.0450243, 0.0312728, 0.0204168, 0.0223589, 0.037532, 0.401999, 0.0189739, 0.0138674, 0.48945, 0.00958389, 0.0389336, 0.426111, 0.0344689, -0.016966, 0.43572, 0.0405954, -0.00180118, 0.424325, 0.0345832, -0.0049196, 0.451419, 0.0430454, -0.010527, 0.394574, 0.0253385, -0.0233193, 0.453278, 0.0254069, -0.0348159, 0.406993, 0.0221221, -0.00813319, 0.489327 )

[sub_resource type="ConvexPolygonShape" id=43]
points = PoolVector3Array( -0.00815312, 0.017971, 0.512305, -0.00482807, -0.0883649, 0.0071429, 0.00181715, 0.101087, 0.0104429, 0.00846563, -0.00524904, 0.52891, 0.00846563, -0.0551225, 0.000490516, -0.00150465, -0.0850307, 0.429176, -0.00815312, 0.0545277, 0.000490516, -0.00150465, 0.0844558, 0.429176, 0.00846563, 0.0545277, 0.000490516, -0.00815312, -0.0451399, 0.422576, 0.00783755, 0.0411747, 0.416744, -0.00815312, -0.0551225, 0.000490516, -0.00482807, 0.0910844, 0.0935715, 0.00782266, -0.0416693, 0.413356, 0.00181715, -0.101662, 0.0104429, -0.00815312, 0.0478792, 0.402619, -0.00815312, -0.0119174, 0.522257, 0.00181715, 0.0811415, 0.435829, 0.00514058, 0.0844558, 0.0437048, -0.00482807, -0.0916792, 0.0669619, 0.00846563, 0.00469391, 0.52891, -0.00482807, 0.0744731, 0.409219, -0.00482807, -0.075068, 0.402619, 0.00846563, -0.0251945, 0.495648, -0.00150465, -0.101662, 0.0736143, 0.00514058, -0.0817164, 0.0603096, -0.00482807, 0.0877701, 0.0071429, -0.00150465, 0.101087, 0.0736143, -0.00815312, 0.00798838, 0.52891, 0.00846563, 0.0213052, 0.5023, -0.00482807, -0.0650853, 0.455786, 0.00181715, -0.0185658, 0.518957, 0.00514058, 0.0412308, 0.489048, 0.00514058, -0.0484741, 0.475743, -0.00482807, 0.0678247, 0.449133, -0.00815312, -0.0551225, 0.160043, -0.00482807, 0.0511935, 0.475743, 0.0077811, 0.0439295, 0.391209, 0.00181715, 0.017971, 0.518957, -0.00482807, -0.0418256, 0.489048, 0.00181715, -0.061771, 0.462438, -0.00815312, 0.0378966, 0.459138, -0.00482807, 0.00467406, 0.532262, -0.00815312, -0.0318628, 0.479043, 0.00514058, 0.0844558, 0.0071429, -0.00815312, -0.00526888, 0.52891, 0.00514058, -0.0817164, 0.0071429, -0.00482807, -0.0185658, 0.518957, 0.00514058, -0.0451399, 0.482395, -0.00482807, 0.017971, 0.518957, -0.00482807, -0.0684195, 0.445833 )

[sub_resource type="ConvexPolygonShape" id=44]
points = PoolVector3Array( -0.0312923, 0.0197563, 0.442765, -0.0114775, -0.0484819, -0.00277048, -0.0513619, -0.0318478, -0.00277048, -0.0114775, 0.0479069, -0.00277048, -0.00815735, -0.0451513, 0.412538, -0.0513619, 0.0312823, -0.00277048, -0.00932448, 0.0421522, 0.405922, -0.0447088, -0.0152327, 0.409235, -0.0347356, 0.0346034, 0.395934, -0.0480375, 0.00468479, 0.385982, -0.00782846, -0.0424544, 0.0442671, -0.0247794, -0.0418301, 0.399283, -0.00815735, 0.0312728, 0.465741, -0.00853558, -0.0313045, 0.461639, -0.0181306, 0.0445763, 0.399283, -0.00956016, 0.0447769, 0.0124431, -0.03806, -0.0285267, 0.409235, -0.0343824, -0.0110867, 0.446051, -0.0447088, 0.0179883, 0.399283, -0.0513619, -0.0318478, 0.0337381, -0.0513619, 0.0312823, 0.0370404, -0.0181306, -0.0451513, 0.395934, -0.00815313, -0.0418301, -0.00277048, -0.0447088, 0.0113365, 0.415886, -0.0347356, -0.0351784, 0.385982, -0.0480375, -0.00525978, 0.385982, -0.0347356, 0.0312823, 0.415886, -0.0447088, -0.0185632, 0.399283, -0.0314112, 0.0379246, 0.385982, -0.0343963, 0.0105442, 0.446697, -0.03806, 0.0312823, 0.385982, -0.0413844, -0.025215, 0.399283, -0.021455, -0.0418301, 0.412583, -0.0282177, -0.0234979, 0.443456, -0.00815988, -0.0451373, 0.0703429, -0.0480375, -0.00194807, 0.392632, -0.0281038, -0.0384996, 0.409235, -0.0413844, 0.0246305, 0.399283, -0.0513619, 0.0246305, 0.0436908, -0.031304, -0.0173786, 0.447468, -0.0513619, -0.0285267, 0.0403885, -0.0251267, 0.0259814, 0.446325, -0.0220474, -0.0295956, 0.442891 )

[sub_resource type="Resource" id=21]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 370, 154.5 )
}
name = "Entry"

[sub_resource type="Resource" id=31]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 488.5, 434.5 )
}
name = "Operator"

[sub_resource type="Resource" id=22]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 688, 94.5 )
}
name = "Player"

[sub_resource type="Resource" id=23]
script = ExtResource( 11 )
__meta__ = {
"graph_offset": Vector2( 902, 276.5 )
}
name = "Spacecraft"

[sub_resource type="Resource" id=25]
script = ExtResource( 13 )
from = "Entry"
to = "Player"
conditions = {
}

[sub_resource type="Resource" id=38]
script = ExtResource( 14 )
name = "player"

[sub_resource type="Resource" id=39]
script = ExtResource( 13 )
from = "Operator"
to = "Player"
conditions = {
"player": SubResource( 38 )
}

[sub_resource type="Resource" id=36]
script = ExtResource( 14 )
name = "spacecraft"

[sub_resource type="Resource" id=37]
script = ExtResource( 13 )
from = "Operator"
to = "Spacecraft"
conditions = {
"spacecraft": SubResource( 36 )
}

[sub_resource type="Resource" id=32]
script = ExtResource( 14 )
name = "operator"

[sub_resource type="Resource" id=33]
script = ExtResource( 13 )
from = "Player"
to = "Operator"
conditions = {
"operator": SubResource( 32 )
}

[sub_resource type="Resource" id=26]
script = ExtResource( 14 )
name = "spacecraft"

[sub_resource type="Resource" id=27]
script = ExtResource( 13 )
from = "Player"
to = "Spacecraft"
conditions = {
"spacecraft": SubResource( 26 )
}

[sub_resource type="Resource" id=34]
script = ExtResource( 14 )
name = "operator"

[sub_resource type="Resource" id=35]
script = ExtResource( 13 )
from = "Spacecraft"
to = "Operator"
conditions = {
"operator": SubResource( 34 )
}

[sub_resource type="Resource" id=28]
script = ExtResource( 14 )
name = "player"

[sub_resource type="Resource" id=29]
script = ExtResource( 13 )
from = "Spacecraft"
to = "Player"
conditions = {
"player": SubResource( 28 )
}

[sub_resource type="Resource" id=30]
script = ExtResource( 12 )
name = ""
states = {
"Entry": SubResource( 21 ),
"Operator": SubResource( 31 ),
"Player": SubResource( 22 ),
"Spacecraft": SubResource( 23 )
}
transitions = {
"Entry": {
"Player": SubResource( 25 )
},
"Operator": {
"Player": SubResource( 39 ),
"Spacecraft": SubResource( 37 )
},
"Player": {
"Operator": SubResource( 33 ),
"Spacecraft": SubResource( 27 )
},
"Spacecraft": {
"Operator": SubResource( 35 ),
"Player": SubResource( 29 )
}
}

[node name="Matrix" type="Node"]

[node name="World" type="Node" parent="."]
script = ExtResource( 5 )

[node name="Player" parent="World" instance=ExtResource( 7 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.783736, 0 )
camera = NodePath("PlayerCam")

[node name="PlayerCam" parent="World/Player" instance=ExtResource( 15 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.22763, 0 )
CAMERA_CONTROLLER_ROTATION_SPEED = 7.0
camera_basis = Vector3( 0, 3, 0 )

[node name="Commands" type="Node" parent="World/Player/PlayerCam"]

[node name="SpacecraftControl" parent="World" instance=ExtResource( 1 )]
transform = Transform( 1, 0, 1.11022e-16, 0, -0.0551419, 0.998479, 0, -0.998479, -0.0551419, 0, 35.4788, 0 )

[node name="State" type="Node" parent="World/SpacecraftControl"]
script = ExtResource( 10 )
state_machine = SubResource( 20 )

[node name="SpaceX_Starship" parent="World/SpacecraftControl" instance=ExtResource( 9 )]

[node name="RigidBody" type="RigidBody" parent="World/SpacecraftControl"]
transform = Transform( 1, 8.27181e-25, -6.72084e-25, 0, 1, 0, 0, 0, 1, 2.49327e-15, 1.24023, -22.4575 )

[node name="CollisionShape3" type="CollisionShape" parent="World/SpacecraftControl/RigidBody"]
transform = Transform( -1.19209e-05, -100, 0, 100, -1.19209e-05, 0, 0, 0, 100, 0, 0, 0 )
shape = SubResource( 42 )

[node name="CollisionShape2" type="CollisionShape" parent="World/SpacecraftControl/RigidBody"]
transform = Transform( -1.19209e-05, -100, 0, 100, -1.19209e-05, 0, 0, 0, 100, 0, 0, 0 )
shape = SubResource( 43 )

[node name="CollisionShape4" type="CollisionShape" parent="World/SpacecraftControl/RigidBody"]
transform = Transform( -1.19209e-05, -100, 0, 100, -1.19209e-05, 0, 0, 0, 100, 0, 0, 0 )
shape = SubResource( 44 )

[node name="SpacecraftCam" parent="World" instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.23516e-22, -3.8147e-06, 1.19209e-07 )
target = NodePath("../SpacecraftControl")
distance = 20.0

[node name="Operator" parent="World" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.779129, 0, 11.4547 )

[node name="OperatorCam" parent="World/Operator" instance=ExtResource( 15 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.779129, 3.01137, -11.4547 )
target = NodePath("..")
CAMERA_CONTROLLER_ROTATION_SPEED = 7.0
camera_basis = Vector3( 0, 3, 0 )

[node name="Commands" type="Node" parent="World/Operator/OperatorCam"]

[node name="Terrain" parent="World" instance=ExtResource( 3 )]

[node name="Avatar" type="Node" parent="."]
script = ExtResource( 4 )
PlayerCam = NodePath("../World/Player/PlayerCam")
SpacecraftCam = NodePath("../World/SpacecraftCam")
OperatorCam = NodePath("../World/Operator/OperatorCam")
Player = NodePath("../World/Player")
Spacecraft = NodePath("../World/SpacecraftControl")
Operator = NodePath("../World/Operator")
SpacecarftUI = NodePath("UI/SpacecraftUI")

[node name="State" type="Node" parent="Avatar"]
script = ExtResource( 10 )
state_machine = SubResource( 30 )

[node name="UI" type="Node" parent="Avatar"]

[node name="SpacecraftUI" parent="Avatar/UI" instance=ExtResource( 6 )]
target = NodePath("")

[connection signal="thrust" from="World/SpacecraftControl" to="World/SpacecraftControl/SpaceX_Starship" method="_on_SpacecraftControl_thrust"]
[connection signal="transited" from="Avatar/State" to="Avatar" method="_on_State_transited"]
